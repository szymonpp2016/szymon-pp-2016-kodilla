use kodilla_course;
DROP TABLES  IF EXISTS STATS;

create table STATS (
STAT_ID INT(11) AUTO_INCREMENT,
STAT_DATE DATETIME NOT NULL,
STAT VARCHAR(20) NOT NULL,
VAL INT(11) NOT NULL,
PRIMARY KEY(`STAT_ID`)
);

use kodilla_course;
DROP view IF EXISTS BESTSELLERS_COUNT;

Create view BESTSELLERS_COUNT (STAT) As
SELECT count(*)
from  books bk
where bk.bestseller = true;


commit;
use kodilla_course;
select * from BESTSELLERS_COUNT;

DROP event IF EXISTS BESTSELLERS_EVENT;

DELIMITER $$

create event BESTSELLERS_EVENT
on schedule every 1 minute
do  begin
call UpdateBookLevels();

INSERT INTO STATS(STAT_DATE, STAT, VAL)
					VALUES (CURTIME(), 'BESTSELLER', BESTSELLERS_COUNT.STAT);
End$$

DELIMITER ;

select * from stats;